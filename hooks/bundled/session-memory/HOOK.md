# Session Memory Hook

Automatically saves session context to memory files when sessions end.

## What It Does

When a session ends, this hook:

1. **Captures session data** - Collects session metadata, events, and context
2. **Generates filename** - Creates descriptive filename based on session content
3. **Saves to memory** - Writes session summary to memory directory
4. **Organizes content** - Creates structured markdown files with session information

## Features

- **Automatic capture** - No manual intervention required
- **Descriptive naming** - Uses timestamps and session content for filenames
- **Structured format** - Saves data in readable markdown format
- **Configurable retention** - Old memory files can be automatically cleaned up
- **Error resilient** - Continues working even if some data is missing

## Configuration

The hook supports optional configuration:

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `enabled` | boolean | `true` | Enable/disable the hook |
| `priority` | integer | `200` | Execution priority |
| `timeout` | integer | `30` | Maximum execution time in seconds |
| `max_memory_files` | integer | `100` | Maximum memory files to keep |
| `include_messages` | boolean | `true` | Include session messages |

Example configuration:

```json
{
  "hooks": {
    "session-memory": {
      "enabled": true,
      "priority": 200,
      "timeout": 30,
      "max_memory_files": 100,
      "include_messages": true
    }
  }
}
```

## Output Format

Memory files are created with the following format:

```markdown
# Session Memory: session_key_20241201_143022

**Timestamp:** 2024-12-01T14:30:22.123Z
**Agent ID:** agent:main
**Channel ID:** discord:123456
**User ID:** user:789012
**Session Duration:** 1247 seconds

## Session Summary

This session involved debugging a webhook integration issue.

### Key Events
- Started with webhook configuration
- Encountered authentication errors
- Implemented error handling
- Successfully deployed solution

### Performance Metrics
- Total commands: 15
- Successful operations: 12
- Error rate: 20%
- Average response time: 1.2s

---
*Generated by AgentBus Hook System on 2024-12-01T14:50:22.123Z*
```

## File Location

Memory files are saved to: `<workspace>/memory/session_<session_key>_<timestamp>.md`

## Benefits

- **Session continuity** - Easy to review past sessions
- **Knowledge capture** - Preserves important decisions and solutions
- **Debugging aid** - Helps troubleshoot recurring issues
- **Performance tracking** - Monitors session metrics over time
- **Backup mechanism** - Prevents loss of valuable session data

## Cleanup

The hook can automatically clean up old memory files when configured with `max_memory_files`.
This helps manage disk space while preserving recent session data.

## Integration

This hook works seamlessly with other AgentBus features:

- **Session Manager** - Receives session lifecycle events
- **Message History** - Captures conversation context
- **Performance Monitor** - Includes execution metrics
- **Error Tracker** - Logs any issues encountered